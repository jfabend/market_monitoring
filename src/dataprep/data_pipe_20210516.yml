# fill up the na values by their former values
# (The colnames stay the same afterwards)
p2:
  func: fill_na_with_last_value
  cols:
    - c_industrial_production__value
    - c_us_national_unemployment_rate__value
    - c_capacity_utilization__value
    #- c_sp500__close
p97:
 func: drop_na_rows
# Smoothing of the features
  # fed_funds_rate: 60, 120, 200 Tage
  # capa_util: 300, 600
  # us_unemployment: 300, 600, 900
  # industrial_production: 90, 180
  # sp500: 200
  # (adds prefix "_mavg_[days]" as colnames)
p3:
  func: rolling_mean
  cols:
    - c_fed_funds_rate__value
  days: 60
p4:
  func: rolling_mean
  cols:
    - c_industrial_production__value
  days: 90
p5:
  func: rolling_mean
  cols:
    - c_fed_funds_rate__value
  days: 120
p96:
  func: rolling_mean
  cols:
    - c_fed_funds_rate__value
  days: 150
p99:
  func: rolling_mean
  cols:
    - c_industrial_production__value
  days: 180
p6:
  func: rolling_mean
  cols:
    - c_fed_funds_rate__value
  days: 200
p7:
  func: rolling_mean
  cols:
    - c_capacity_utilization__value
    - c_us_national_unemployment_rate__value
    - c_sp500__close
  days: 300
p8:
  func: rolling_mean
  cols:
    - c_capacity_utilization__value
    - c_us_national_unemployment_rate__value
  days: 600
p98:
  func: rolling_mean
  cols:
    - c_us_national_unemployment_rate__value
  days: 900
# rate of change for the smoothed features
# (comparison to the value of the former day)
# Days of Smoothing of features
  # fed_funds_rate: 60, 120, 200
  # capa_util: 300, 600
  # us_unemployment: 300, 600, 900
  # industrial_production: 90, 180
  # sp500: 200
p10:
  func: col_past_percent_delta
  cols:
    - c_industrial_production__value_mavg_90
    - c_industrial_production__value_mavg_180
    - c_us_national_unemployment_rate__value_mavg_300
    - c_us_national_unemployment_rate__value_mavg_600
    - c_us_national_unemployment_rate__value_mavg_900
    - c_capacity_utilization__value_mavg_300
    - c_capacity_utilization__value_mavg_600
    - c_fed_funds_rate__value_mavg_60
    - c_fed_funds_rate__value_mavg_120
    - c_fed_funds_rate__value_mavg_200
  days: 180
# Prepair SP500 Targets
# Calculate difference in percent between sp500 and the moving averages
# (We are not interested in the longterm increase)
# (but in the mid-term drawdowns)
p11:
  func: new_col_substract
  base_col: c_sp500__close
  sub_col: c_sp500__close_mavg_300
  new_col: sp_actual_mavg_300_diff
p12:
  func: two_cols_percent_delta
  base_col: c_sp500__close
  second_col: sp_actual_mavg_300_diff
  new_col: sp_actual_mavg_300_diffperc
# Now calculate the daily rate of change of the diffperc to the sp500
p13:
  func: col_past_percent_delta
  cols: sp_actual_mavg_300_diffperc
  days: 10
# Smooth it by ten days
p14:
  func: rolling_mean
  cols:
    - sp_actual_mavg_300_diffperc_changeperc_10
  days: 2000
p93:
  func: set_positive_values_to_zero
  cols: sp_actual_mavg_300_diffperc_changeperc_10_mavg_2000
p87:
  func: rename_col
  old_colname: sp_actual_mavg_300_diffperc_changeperc_10_mavg_2000
  new_colname: target
# Actual build of the targets
p17:
  func: less_greater_encoding
  cols: target
  threshold: 0.1
p89:
  func: shift_cols_preview
  cols: target_lessgreatenc
  days: 50
p18:
  func: drop_na_rows